# 시스템

## 목차

- 도시를 세운다면?
- 시스템 제작과 시스템 사용을 분리하라
  - Main 분리
  - 팩토리
  - 의존성 주입
- 확장
  - 횡단(cross-cutting) 관심사
- 자바 프록시
- 순수 자바 AOP 프레임워크
- AspectJ 관점
- 테스트 주도 시스템 아키텍처 구축
- 의사 결정을 최적화하라
- 명백한 가치가 있을 때 표준을 현명하게 사용하라
- 시스템은 도메인 특화 언어가 필요하다
- 결론

> "복잡성은 죽임이다. 개발자에게서 생기를 앗아가며,  
> 제품을 계획하고 제작하고 테스트하기 어렵게 만든다."  
> 레이 오지

### 도시를 세운다면?

---

깨끗한 코드를 구현하면 낮은 추상화 수준에서 관심사를 분리하기 쉬워진다.  
높은 추상화 수준, 즉 **시스템** 수준에서도 꺠끗함을 유지하는 방법을 살펴본다.

### 시스템 제작과 시스템 사용을 분리하라

---

**제작**은 **사용**과 아주 다르다는 사실을 명심한다.  
시작 단계는 모든 애플리케이션이 풀어야 할 **관심사**다.  
**관심사 분리**는 우리 분야에서 가장 오래되고 가장 중요한 설계 기법 중 하나다.  
체계적이고 탄탄한 시스템을 만들고 싶다면 흔히 쓰는 좀스럽고 **손쉬운** 기법으로 모듈성을 꺠지마라  
설정 논리는 일반 실행 논리와 분리해야 모듈성이 높아진다.  
또한, 주요 의존성을 해소하기 위한 방식, 즉 전반적이며 일관적인 방식도 필요하다.

---

#### Main 분리

생성과 관련한 코드는 모두 main 이나 main 이 호출하는 모듈로 옮기고,  
나머지 시스템은 모든 객체가 생성되었고 모든 의존성이 연결되었다고 가정해라.

#### 팩토리

**추상 팩토리 패턴**을 사용하면, 객체가 생성되는 시점을 애플리케이션이 결정 할 수가 있다.

#### 의존성 주입

사용과 제작을 분리하는 강력한 메커니즘 하나가 **의존성 주입**이다.  
제어 역전에서는 한 객체가 맡은 보조 책임을 새로운 객체에게 전적으로 떠넘긴다.  
의존성 관리 맥락에서 객체는 의존성 자체를 인스턴스로 만드는 책임을 지지 않는다.  
대신에 이런 책임을 다른 '전담' 메커니즘에 넘겨라.

### 확장

---

'처음부터 올바르게' 시스템을 만들 수 있다는 믿음은 미신이다.  
오늘 주어진 사용자 스토리에 맞춰 시스템을 구현해야 한다.  
깨끗한 코드는 코드 수준에서 시스템을 조정하고 확장하기 쉽게 만든다.

> 소프트웨어 시스템은 물리적인 시스템과 다르다.  
> 관심사를 적절히 분리해 관리한다면 소프트웨어 아키텍처는 점진적으로 발전할 수 있다.

#### 횡단(cross-cutting)관심사

모든 객체가 전반적으로 동일한 방식을 이용하게 만들어야 한다.  
AOP에서 **관점**이라는 모듈 구성 개념은 "특정 관심사를 지원 하려면 시스템에서 특정 지점들이 동작하는 방식을 일관성 있게 바꿔야 한다."

### 자바 프록시

자바 프록시는 단순한 상황에 적합하다.  
프록시를 사용하면 깨끗한 코드를 작성하기 어렵다!  
또한, 프록시는 (진정한 AOP 해법에 필요한) 시스템 단위로 실행 '지점'을 명시하는 메커니즘도 제공하지 않는다.

### 순수 자바 AOP 프레임워크

스프링 관련 자바 코드가 거의 필요 없으므로 애플리케이션은 **사실상 스프링과 독립적이다.**

### AspectJ관점

### 테스트 주도 시스템 아키텍처 구축

---

코드 수준에서 아키텍처 관심사를 분리할 수 있다면, 진정한 **테스트 주도** 아키텍처 구축이 가능해진다.  
빅 테크 회사들이 고도의 자료 캐싱, 보안, 가상화 등을 이용해  
아주 높은 가용성과 성능을 효율적이고도 유연하게 달성했다.  
설계가 최대한 분리되어 각 추상화 수준과 범위에서 코드가 적당히 단순하기 때문이다.  
좋은 API는 걸리적거리지 않아야 한다.

> 최선의 시스템 구조는 각기 POJO (또는 다른) 객체로 구현되는 모듈화된 관심사 영역(도메인)으로 구성된다.  
> 이렇게 서로 다른 영역은 해당 영역 코드에 최소한의 영향을 미치는 관점이나 유사한 도구를 사용해 통합한다.  
> 이런 구조 역시 코드와 마찬가지로 테스트 주도 기법을 적용할 수 있다.

### 의사 결정을 최적화하라

---

가정 적합한 사람에게 책임을 맡겨라.  
**가능한 마지막 순간까지 결정을 미루는** 방법이 최선이다.  
너무 일찍 결정하면 고객 피드백을 더 모으고, 프로젝트를 더 고민하고, 구현 방안을 더 탐험할 기회가 사라진다.

> 관심사를 모듈로 분리한 POJO 시스템은 기민함을 제공한다.
> 이런 기민함 덕택에 최신 정보에 기반해 최선의 시점에 최적의 결정을 내리기 쉬워진다.
> 또한 결정의 복잡성도 줄어든다.

### 명백한 가치가 있을 떄 표준을 현명하게 사용하라

---

너무 표준에 집착하지 마라.

### 시스템은 도메인 특화 언어가 필요하다.

---

좋은 DSL은 도메인 개념과 그 개념을 구현한 코드 사이에 존재하는 '의사소통 간극'을 줄여준다.

### 결론

---

시스템은 깨끗해야 한다.  
모든 추상화 단계에서 의도는 명확히 표현해라.  
시스템을 설계하든 개별 모듈을 설계하든, 실제로 **돌아가는 가장 단순한 수단**을 사용해야 한다.
